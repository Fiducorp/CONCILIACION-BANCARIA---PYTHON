üìä AN√ÅLISIS INFORMAR: M√ìDULO SOLICITUD DE PAGO

FASE 0: DISE√ëO VISUAL COMPLETO
‚îú‚îÄ‚îÄ 0.1 Mockup de FormMenuCartasSolicitudes (men√∫ lateral + panel derecho)
‚îú‚îÄ‚îÄ 0.2 Mockup de FormSolicitudPago (layout completo)
‚îú‚îÄ‚îÄ 0.3 Mockup de mini-forms (Nota Cr√©dito/D√©bito, Agregar Fideicomiso, Agregar Proveedor)
‚îî‚îÄ‚îÄ 0.4 Aprobaci√≥n del dise√±o

FASE 1: PREPARAR ENTORNO
‚îú‚îÄ‚îÄ 1.1 Verificar estructura de carpetas existente
‚îú‚îÄ‚îÄ 1.2 Verificar tablas de auditor√≠a actuales
‚îú‚îÄ‚îÄ 1.3 Crear carpeta Forms/Contabilidad/CuentasPorPagar/
‚îî‚îÄ‚îÄ 1.4 Definir clases de modelos (POCOs)

FASE 2: BASE DE DATOS
‚îú‚îÄ‚îÄ 2.1 Script SQL: Tablas de cat√°logos (TIPOS_NCF, MONEDAS, TIPOS_PAGO, etc.)
‚îú‚îÄ‚îÄ 2.2 Script SQL: Tabla FIDEICOMISOS
‚îú‚îÄ‚îÄ 2.3 Script SQL: Tabla PROVEEDORES
‚îú‚îÄ‚îÄ 2.4 Script SQL: Tablas SOLICITUDES_PAGO y relacionadas
‚îú‚îÄ‚îÄ 2.5 Script SQL: Tabla FIRMAS_USUARIOS
‚îú‚îÄ‚îÄ 2.6 Script SQL: Tabla CONFIGURACION_MODULO
‚îú‚îÄ‚îÄ 2.7 Script SQL: Insertar datos iniciales
‚îî‚îÄ‚îÄ 2.8 Verificar/actualizar tablas de AUDITORIA

FASE 3: FORMULARIOS BASE
‚îú‚îÄ‚îÄ 3.1 FormDashboardCuentasPorPagar (cards: Cartas y Solicitudes, Configuraci√≥n)
‚îú‚îÄ‚îÄ 3.2 FormMenuCartasSolicitudes (men√∫ lateral + panel din√°mico)
‚îî‚îÄ‚îÄ 3.3 Conectar navegaci√≥n desde FormDashboardContabilidad

FASE 4: FORMULARIO SOLICITUD DE PAGO
‚îú‚îÄ‚îÄ 4.1 Estructura base del formulario
‚îú‚îÄ‚îÄ 4.2 Secci√≥n: Datos Generales (Fecha, Fideicomiso, Proveedor, Tipo Pago)
‚îú‚îÄ‚îÄ 4.3 Secci√≥n: Comprobantes (con lista din√°mica)
‚îú‚îÄ‚îÄ 4.4 Secci√≥n: Concepto
‚îú‚îÄ‚îÄ 4.5 Secci√≥n: Montos y Subtotales (con lista din√°mica)
‚îú‚îÄ‚îÄ 4.6 Secci√≥n: Retenciones y c√°lculos autom√°ticos
‚îú‚îÄ‚îÄ 4.7 Secci√≥n: Notas Cr√©dito/D√©bito (con las 2 maneras)
‚îú‚îÄ‚îÄ 4.8 Secci√≥n: Avances (con l√≥gica especial)
‚îú‚îÄ‚îÄ 4.9 Secci√≥n: Conversi√≥n de moneda
‚îú‚îÄ‚îÄ 4.10 Secci√≥n: Totales
‚îú‚îÄ‚îÄ 4.11 Botones de acci√≥n (Guardar, Imprimir, Exportar, Limpiar, Buscar)
‚îî‚îÄ‚îÄ 4.12 Sistema de guardado en memoria temporal

FASE 5: MINI-FORMS
‚îú‚îÄ‚îÄ 5.1 Mini-form Agregar Fideicomiso
‚îú‚îÄ‚îÄ 5.2 Mini-form Agregar Proveedor
‚îú‚îÄ‚îÄ 5.3 Mini-form Nota de Cr√©dito
‚îú‚îÄ‚îÄ 5.4 Mini-form Nota de D√©bito
‚îî‚îÄ‚îÄ 5.5 Mini-form Otros Impuestos (configurable)

FASE 6: L√ìGICA DE NEGOCIO
‚îú‚îÄ‚îÄ 6.1 Validaciones en tiempo real
‚îú‚îÄ‚îÄ 6.2 C√°lculos autom√°ticos
‚îú‚îÄ‚îÄ 6.3 Conversi√≥n de moneda (5 m√©todos)
‚îú‚îÄ‚îÄ 6.4 Guardado en BD con auditor√≠a
‚îî‚îÄ‚îÄ 6.5 Carga de registros existentes

FASE 7: EXPORTACI√ìN E IMPRESI√ìN
‚îú‚îÄ‚îÄ 7.1 Dise√±o del formato de impresi√≥n (layout inteligente)
‚îú‚îÄ‚îÄ 7.2 Generaci√≥n de PDF
‚îú‚îÄ‚îÄ 7.3 Generaci√≥n de Excel
‚îî‚îÄ‚îÄ 7.4 Sistema de firmas digitales

FASE 8: CONSULTAS
‚îú‚îÄ‚îÄ 8.1 B√∫squeda r√°pida desde el formulario
‚îî‚îÄ‚îÄ 8.2 FormConsultaSolicitudes (si se requiere)

CONTEXTO INFORMAL COMPLETO:

**CUENTAS POR PAGAR**

**[Formas:]{.underline}**

**SOLICITUD DE PAGO:**

Formulario para registro de facturas de todo tipo.

Luego de ser registrada la solicitud de factura se debe guardar en base de datos y dar la opci√≥n de imprimir.

Estas solicitudes de facturas ya registradas pueden ser consultadas en otra forma, tambi√©n pueden ser reimprimidas, editadas o modificadas, o eliminadas.

La forma en donde se consultar√° ser√° una forma compartida, es decir, que todos los usuarios podr√°n consultar todos los registros de solicitud de pago de todos los usuarios. Pero solo los usuarios propietarios de un registro pueden editarlo o modificarlo y eliminarlo, los dem√°s solo pueden consultar, ver, leer, copiar y guardar como registro propio sin afectar el original, imprimir o luego reimprimir. (Toda acci√≥n quedar√≠a registrada).

Las solicitudes se deben poder consultar desde el mismo formulario (podr√≠a ser una especie de buscador por ID de solicitud de pago, y cargarlas en el formulario) o desde la forma de consultas directamente.

De las solicitudes de pago se deben poder generar las siguientes exportaciones: Documento en PDF de la solicitud (Sin p√©rdida de informaci√≥n, se debe contemplar todo el registro), y documento en Excel de igual manera.

Para realizar una solicitud de pago se toman en cuenta m√∫ltiples datos, listados a continuaci√≥n:

**Datos ingresados por el usuario:**

1.  **Fecha** de la solicitud de pago (Se cargar√° autom√°ticamente con el d√≠a actual, pero el usuario puede cambiarla. ES CAMPO OBLIGATORIO).

2.  **Fideicomiso** (Nombre, ser√° cargado desde una tabla para estos en BD. Habr√° un cuadro para colocar el ID del fideicomiso, y al hacerlo, se cargar√° el fideicomiso con ese c√≥digo en el campo de Fideicomiso, y viceversa, si se elige un fideicomiso directamente desde el campo en donde est√°n cargados los nombres, entonces el campo del ID se cargar√° con el ID correspondiente. Todo esto se debe realizar en tiempo real. ES CAMPO OBLIGATORIO).

3.  **Proveedor** (Nombre, ser√° cargado desde una tabla para estos en BD. ES CAMPO OBLIGATORIO).

4.  **RNC o Cedula** del proveedor (Si se selecciona un Proveedor del control en el que est√©n, por ejemplo, un ComboBox, entonces el control para colocar el RNC o Cedula se deber√° completar autom√°ticamente, y viceversa, si se completa este control con el RNC o Cedula del proveedor, entonces el ComboBox de proveedor se deber√° completar con el nombre de este.ES CAMPO OBLIGATORIO).

5.  **Tipo de comprobante** (NCF, CUBICACION, COTIZACION, ETC. NO ES CAMPO OBLIGATORIO).

6.  **Comprobante** (Numero √∫nico de comprobante, ejemplo: B1100000306. Hay varios tipos de comprobantes, B11, B01, E31, E32, E34, E41... Te listare todos los que hay y los nombres de cada uno porque esto lo usaremos en orden en esta forma y en otras y para an√°lisis. ES CAMPO OBLIGATORIO SOLO SI EL TIPO DE COMPROBANTE ES NCF).

7.  **Concepto** (descripci√≥n de la factura a la que se le hace la solicitud de pago. ES CAMPO OBLIGATORIO).

8.  **Tipo de pago** (Cheque, Transferencia, Efectivo u otro. ES CAMPO OBLIGATORIO).

9.  **Subtotal** (Subtotal de la factura. ES CAMPO OBLIGATORIO).

10. **Exento** (Monto si aplica, ser√≠a un monto al que no se le calculara ITBIS. NO ES CAMPO OBLIGATORIO).

11. **Direcci√≥n t√©cnica** (Monto si aplica. NO ES CAMPO OBLIGATORIO).

12. **Descuento** (Monto si aplica. NO ES CAMPO OBLIGATORIO).

13. **Nota de cr√©dito** (Monto si aplica. NO ES CAMPO OBLIGATORIO).

14. **Nota de d√©bito** (Monto si aplica. NO ES CAMPO OBLIGATORIO).

15. **Avance** (Monto si aplica, es para cuando se est√© haciendo una solicitud de pago con un anticipo de pago hecho previamente. NO ES CAMPO OBLIGATORIO).

16. **Avance para pagar** (Monto si aplica, es cuando se est√° haciendo una solicitud de pago de una factura que ser√° un anticipo de otra. NO ES CAMPO OBLIGATORIO).

17. **Otros impuestos** (Es un campo que debemos dejar reservado al usuario por si hay alg√∫n impuesto que no est√© contemplado en el formulario, este debe ser completamente parametrizable y ajustable a decisi√≥n del usuario. NO ES CAMPO OBLIGATORIO).

18. **En caso de hacerse solicitud de pago a una n√≥mina, entonces:** Un campo para Horas Extras**.** NO ES UN CAMPO OBLIGATORIO**.**

19. **Numero de solicitud** (Solo ser√° en algunos casos, pero debe estar en el formulario. NO ES CAMPO OBLIGATORIO).

20. Nota (Sera un campo en el que el usuario puede agregar alg√∫n comentario o notas sobre la solicitud de pago. NO ES CAMPO OBLIGATORIO).

**C√°lculos autom√°ticos:**

1.  **ITBIS** (El usuario selecciona el porcentaje (16%, 18% u otro, aunque normalmente es 18%) y este debe calcularse del Subtotal o de la Direcci√≥n t√©cnica, a elecci√≥n del usuario, aunque normalmente es al Subtotal, si se selecciona a la Direcci√≥n t√©cnica y no hay valor en Direcci√≥n t√©cnica esto se le debe notificar al usuario en tiempo real. Tambi√©n se debe poder ingresar manualmente, pero internamente este debe ser calculado y en caso de ser diferente al ingresado entonces notificar al usuario de la diferencia. NO ES CAMPO OBLIGATORIO).

2.  **Retenci√≥n del ITBS** (Puede ser en un 30% o 100% del ITBIS calculado. NO ES CAMPO OBLIGATORIO)

3.  **Retenci√≥n de ISR** (Puede ser en un 2%, 10% o 27% del subtotal. NO ES CAMPO OBLIGATORIO)

4.  **Retenci√≥n de SFS** (**Seguro Familiar de Salud.** NO ES CAMPO OBLIGATORIO)

El c√°lculo del SFS (Seguro Familiar de Salud) en Rep√∫blica Dominicana es un porcentaje sobre el salario cotizable, siendo el aporte del empleado un 3.04% y del empleador un 7.09%, sumando un total del 10.13% sobre el salario base (sin incluir horas extras), que se declara y paga a la Tesorer√≠a de la Seguridad Social (TSS) mensualmente para la cobertura de salud del trabajador y su familia.

5.  **Retenci√≥n de AFP (**NO ES CAMPO OBLIGATORIO**)**

**Aplica el Porcentaje del Trabajador:** 

De ese sueldo cotizable, un porcentaje va a tu AFP. Por ejemplo, en Rep√∫blica Dominicana es el 2.87% (parte del 9.97% total). 

6.  TOTAL FACTURA: Es igual a Subtotal + ITBIS + Exento.

7.  TOTAL RETENCION: Es igual a la suma de todas las retenciones aplicadas.

8.  TOTAL DESCUENTO: Es igual a todos los descuentos aplicados.

9.  TOTAL AVANCE: Es igual al total de anticipo.

10. TOTAL A PAGAR: Es igual al Total factura -- Total retenci√≥n -- Total descuento -- Total avance.

**Casos a incluir:**

Generalmente se realiza solicitudes de pago de facturas en pesos, pero habr√° casos en donde la moneda sea d√≥lar o otra. En esos casos debe permitir lo siguiente:

-   Que el usuario pueda elegir la moneda con la que esta trabajando la solicitud, por defecto seria DOP, pero puede cambiarla, y al hacerlo debe cambiar la l√≥gica explicada m√°s adelante. NO ES CAMPO OBLIGATORIO.

-   Que el usuario pueda elegir la tasa cambiaria en caso de ser moneda extranjera, en caso de ser dominicana entonces no es necesario. NO ES CAMPO OBLIGATORIO A MENOS QUE SE HAYA ELEGIDO MONEDA EXTRANJERA.

**Entonces, una vez abarquemos todo esto, el funcionamiento seria de la siguiente manera:**

El usuario completa al menos todos los campos obligatorios, y luego se le habilita el bot√≥n de guardar el cual por defecto estar√≠a deshabilitado hasta que se completen al menos los campos obligatorios. Si ya fueron completados entonces debe guardarse el registro de la solicitud en su respectiva tabla en base de datos, y posteriormente dar la opci√≥n al usuario de imprimir dicho registro. En caso de que si se le debe habilitar el cuadro de impresi√≥n para que configure a gusto e imprima la solicitud. La cual se imprimir√° en un formato PREDEFINIDO, que determinaremos mas adelante. En caso de que no entonces que se le notifique que fue guardada exitosamente y se limpia el formulario. Esto solo seria el formulario de solicitud de pago, pero habr√° otras formas (formularios) que ser√°n para trabajar con esos registros de otra manera que te indicare mas adelante.

Hay un caso con relaci√≥n al Subtotal y a los comprobantes. Son los siguientes:

-   **Con relaci√≥n al Subtotal**: Habr√°n ocasiones en las que se le est√© realizando una √∫nica solicitud de pago a varias facturas que est√©n bajo la misma relaci√≥n de proveedor y fideicomiso, en esos casos se le debe permitir al usuario ingresar, de forma individual, todos los subtotales que tenga seg√∫n el n√∫mero de facturas a las que le har√° una sola solicitud de pago, el limite de subtotales debe ser 10 subtotales, pero ese l√≠mite debe poder ser configurable, para reducirlo hasta 1 o aumentarlo hasta 100. Entonces la suma de todos los subtotales dar√≠a un √∫nico Subtotal del cual se estar√≠an realizando c√°lculos como el ITBIS entre otros, si aplican. De alguna manera se debe identificar cuando es un √∫nico Subtotal y cuando es la suma de varios Subtotales. Y estos deben guardarse en base de datos, por si posteriormente se consulta el registro de la solicitud de pago, el usuario pueda visualizar cada subtotal que ingreso, en caso de que se haya hecho as√≠. Debe tener varias funcionalidades, como, por ejemplo. Si ingresar√© dos o mas subtotales del mismo monto, cuando este ingresando un subtotal, el sistema debe permitirme indicar que este se repetir√° dos o mas veces para que autom√°ticamente lo tome como m√°s de uno seg√∫n las veces indicadas y los multiplique autom√°ticamente. Y todo esto debe de guardarse correctamente en base de datos. Para fines de control total.

-   **Con relaci√≥n a los comprobantes:** B√°sicamente es lo mismo que con los Subtotales, debe poder permitir registrar varios comprobantes, que normalmente serian de tipo NCF, pero al contrario que con los subtotales, estos no se pueden repetir y en la solicitud de pago (Formulario y impresiones) no saldr√≠a uno solo sino todos, solo que, abreviados por motivo del espacio en papel y en pantalla, pero en base de datos se guardar√≠an completos. Y si se carga el registro para fines de modificaci√≥n u otro, entonces deben cargar abreviados en el campo, pero si se despliega el miniform donde est√°n todos, entonces deben aparecer completos.

Con relaci√≥n a la moneda extranjera, la l√≥gica de la que hable es la siguiente:

Si el usuario elige una moneda extranjera, la l√≥gica de guardado debe ser diferente, debido a que el usuario SIEMPRE registrara todos los montos en moneda DOP, subtotal, y dem√°s, incluso los c√°lculos autom√°ticos deber√°n ser en moneda DOP en el formulario. Pero si el usuario decide imprimir la solicitud de pago, esta debe reflejar tanto el registro en DOP como la conversi√≥n en la moneda extranjera seleccionada bas√°ndose en la tasa ingresada. Y si mas adelante el usuario quiere cargar un registro de estos en los que se eligi√≥ moneda extranjera, los montos deben cargarse en moneda DOP, no con la conversi√≥n de la moneda extranjera con la tasa. Pero la conversi√≥n debe funcionar de dos maneras:

1.  Primera manera: Todos los montos a convertir se calcular√°n directamente multiplicando la tasa elegida de la moneda extranjera, por todos los montos ingresados por e usuario, que siempre estar√°n en DOP.

2.  Segunda manera: La conversi√≥n ser√° multiplicando √∫nicamente el Subtotal o suma de Subtotales por la tasa elegida, y en base a esta conversi√≥n inicial del subtotal, entonces se calcular√°n el ITBIS (si aplica) y otros c√°lculos autom√°ticos si aplican, directamente del subtotal en DOP ya convertido a moneda extranjera con la tasa, y de ese subtotal ya convertido se calcular√≠an estos c√°lculos autom√°ticos. Debido a que algunas facturas llegaran calculada de esa manera o de la otra y el formulario debe ser lo suficientemente flexible para abarcar ambos casos. Pero los montos que no nazcan directamente del subtotal, o mejor dicho que se calculen o dependan del Subtotal, deber√°n seguirse calculando directamente de su multiplicaci√≥n por la tasa ingresada de la moneda extranjera. Por ejemplo, el descuento, avances, etc.

3.  Debe haber una tercera manera: Y es que el usuario pueda parametrizar todo lo que se calculara directamente multiplicando el monto por la tasa ingresada de la moneda extranjera. Esto para brindar al usuario total control sobre las conversiones. Para regular cualquier diferencia cambiaria.

Mas adelante definiremos el formato con el que se imprimir√° la solicitud de pago, y el formato con el que se exportar√° a Excel y a PDF.

Pero ahora podemos ir definiendo como se ir√°n formateando alguno de los campos dentro del formulario de solicitud de pago.

-   Todos los campos con montos tendr√°n un formato moneda, y este formato se cambiar√° en tiempo real si el usuario cambia a moneda extranjera, coloc√°ndose entonces el formato moneda de la misma moneda elegida que por defecto ser√° DOP, pero este formato moneda no debe interferir con los montos en si dentro del campo, por lo que preferir√≠a que este dentro del campo, pero cono en un √°rea donde no se pueda modificar o chocar con los n√∫meros. Y al escribir un numero en uno de estos campos, se debe colocar las comas y los puntos para separar el n√∫mero. Este formateo seria para agregar las separaciones de miles con comas y los decimales con el punto, y si no lleva decimales ingresados por el usuario el sistema debe poner ".00" al final del n√∫mero, pero ser√≠a luego de que el usuario salga del campo en el que puso el n√∫mero, y si el usuario vuelve a entrar al campo para hacer alguna modificaci√≥n o borrar o lo que sea, entonces debe mantenerse el formato, y si el usuario borra alg√∫n numero o varios el formateo del numero debe realizarse nuevamente y correctamente con el numero cambiado seg√∫n los cambios hechos por el usuario.

-   Con relaci√≥n al RNC o Cedula del proveedor, luego de esta ser ingresada debe de formatearse autom√°ticamente con los guiones en donde corresponde, en caso de RNC serian solo 9 d√≠gitos, en el siguiente formato: 000-000000; la cedula tiene 13 d√≠gitos, en el siguiente formato: 000-0000000-0. Este formato debe colocarse luego de ser ingresado el RNC o Cedula, y si el usuario desea cambiar algo luego, el formato debe quitarse al ingresar nuevamente al campo y colocarse una vez se vuelva a salir del mismo, esto para evitar confusiones. Si se elige proveedor por nombre, el RNC o Cedula debe cargarse autom√°ticamente con el formato correspondiente.

-   Con relaci√≥n a la fecha en todos los campos que lleven fecha se mantendr√° el siguiente formato: Se ir√°n colocando los "/" de forma autom√°tica y en tiempo real, por ejemplo, escribo 17 debe aparecer un "/", luego escribo 01 debe aparecer un "/" luego el a√±o 2026 y como resultado tendr√≠a 17/01/2026. Y si el usuario quiere modificar el d√≠a o el mes, el formato debe mantenerse. Y si se coloca en mes 1 en vez de 01 el sistema autom√°ticamente debe agregarle su cero y colocar el 01 del mes. Lo mismo si es con los d√≠as. Esto es solo si el usuario desea escribir manualmente la fecha, pero evidentemente usaremos controles de fecha para abrir el cuadro y simplemente seleccionar la fecha que se quiera.

-   El concepto tendr√° salto de l√≠nea despu√©s de cierta cantidad de caracteres, y debe ser as√≠ al momento de digitarlo en el formulario. Para que se vaya visualizando como quedara en la impresi√≥n o exportaci√≥n del registro de la solicitud de pago.

-   El registro de m√∫ltiples NCF tambi√©n tendr√≠an salto de l√≠nea despu√©s de cierta cantidad de caracteres, por el mismo motivo que el concepto.

El sistema colocara de forma autom√°tica un numero identificador a cada solicitud de pago que se haga, y este n√∫mero tambi√©n se imprimir√≠a o exportar√≠a en la solicitud de pago. Empezando con el 1.

Si se har√° una nota de cr√©dito en la solicitud, entonces debe abrirse un cuadro pidiendo Monto de la nota, el ITBIS de la nota se calcular√° solo y una Descripci√≥n. Entonces a elecci√≥n del usuario en la impresi√≥n o exportaciones saldr√°n todos los datos de la nota, o solo el monto total.

Para gestionar mejor el espacio. Habr√° ocasiones en las que se utilicen unos campos, y otros no, entonces para cada caso se debe dise√±ar un sistema que redistribuya coherentemente todos los campos que se usaran al momento de presentarlos en la hoja impresa o en las exportaciones, y no colocando los campos que no se usaron. Esto debe ser lo mas inteligente posible. Para siempre generar una buena y entendible solicitud de pago. Y en caso de que se utilicen casi todos o todos los campos, estos deben estar bien distribuidos y con tama√±o de letra legible, de 12 o mas para campos de registros y mucho mayor para t√≠tulos y secciones.

Habr√≠a siempre el titulo de Solicitud de pago arriba de todo y en grande. Cerca de una esquina estar√≠a el ID. Y ya despu√©s todos los dem√°s campos con sus tama√±os y dimensiones establecidas.

**Algo que quiero que a√±adamos al sistema completo es lo siguiente:**

Un sistema de firmas. Estas estar√≠an cargadas en el sistema, en formato PNG o uno que me recomiendes. Y se le colocara a decisi√≥n del usuario a la impresi√≥n y/o exportaci√≥n de la solicitud de pago que registre y se usara tambi√©n en otras cosas que implementaremos mas adelante. Esto para evitar que el usuario tenga siempre que estar firmando f√≠sicamente la hoja impresa, sino que directamente se imprima con la firma (A COLOR), tambi√©n se guarde a color en la exportaci√≥n en PDF o en la exportaci√≥n en Excel. Solo el mismo usuario podr√≠a utilizar su firma registrada en el sistema en sus solicitudes de pago o en otras formas que m√°s adelante implementaremos.

TODO DEBE GUARDARSE CORRECTAMENTE EN BASE DE DATOS.

Todo esto es solo con relaci√≥n a las SOLICITUDES DE PAGO, pero el m√≥dulo de cuentas por pagar tendr√° muchas mas cosas, y alguna de ellas trabajaran en conjunto.

DESPUES DE CONCLUIR TODO LO DE LA SOLICITUD DE PAGO, CONTINUAREMOS CON:

CERTIFICADO DE RETENCION.

RELACION DE PAGO.

RELACION DE ANTICIPOS.

CARTA DE DESISTIMIENTO.

ETC.

BLOQUES A√ëADIDOS POSTERIORMENTE PARA SER MAS ESPECIFICOS:

A CONSIDERAR:
En Rep√∫blica Dominicana, los n√∫meros de comprobantes fiscales (NCF) tienen dos estructuras principales: los tradicionales (no electr√≥nicos) con 11 caracteres (una letra y 10 n√∫meros) y los comprobantes fiscales electr√≥nicos (e-NCF) que constan de 13 caracteres (una letra y 12 n√∫meros/d√≠gitos), que identifican serie, tipo y secuencia num√©rica para cada transacci√≥n. 
‚ùì PREGUNTAS ANTES DE COMENZAR
¬øYa existen las tablas de Fideicomisos y Proveedores? ¬øO debo crearlas tambi√©n?
SE HARAN DESDE CERO. AUN NO SE HAN CREADO.
¬øTienes los tipos de NCF completos? Mencionas B11, B01, E31, E32, E34, E41... ¬øhay m√°s?
SE USARAN TODOS LOS QUE LA DGII TIENE PARA REP. DOM.
¬øHay un cat√°logo de monedas espec√≠fico? ¬øO solo DOP y USD?
USA LAS PRINCIPALES A NIVEL MUNDIAL, PERO QUE ENTRE LAS OPCIONES USD SEA DE LS PRIMERAS.
Para la impresi√≥n: ¬øTienen un formato corporativo existente (logo, colores, membrete)?
LO DEBEMOS DEFINIR
¬øEmpezamos con la Fase 1 (Base de datos) o prefieres que prepare todo el c√≥digo de una vez?
NO. VAMOS PASO POR PASO. NO PODEMOS HACER UNA CASA EMPEZANDO POR EL TECHO.
Tipo Pago es uno de los campos principales, creo que deber√≠a estar mas arriba, y no en "Otros". 
La arquitectura para el formulario que propones no esta mal, pero debe ser mejor pensada, en caso de que se vayan a registrar muchas cosas, por ejemplo muchos subtotales o comprobantes. Que no hayan desbordamientos sino que el formulario sepa como manejar todo esto.
Con relaci√≥n a los subtotales, si se ponen mas de uno la conversion a moneda extranjera seria solo a la suma, no a los montos individualmente. Aunque esto tambi√©n debe ser configurable a elecci√≥n del usuario. Si convertir todos individualmente y luego sumar, o sumar y luego convertir.
Las conversiones solo se reflejaran a nivel interno, no en el mismo formulario. Pero esto tambi√©n debe ser configurable, si el usuario lleno todos los campo de montos que usara, y luego cambia a una moneda extranjera y coloca la tasa, entonces puede habilitar, para que de forma autom√°tica todos los campos de montos en el form se les conviertan seg√∫n la opci√≥n de conversion que elija. Y esto debe poder ser reversible sin inconvenientes a moneda DOP o a su vez, convertida a cualquier otra moneda y tasa ingresada por el usuario.
Si se te ocurren mas m√©todos de conversion a dem√°s de los tres que propuse, puedes agregarlo, para que el sistema sea mas completo. Y mejor pensado.

A considerar:

Nota de cr√©dito y debito de trabajaran igual. En este caso. Y ambas tendr√°n varias funcionalidades:

Estas notas a decisi√≥n del usuario podr√°n ser de dos maneras:

Manera uno: La nota se registrara normal, mediante el miniform y en el campo aparecer√° el monto total de la nota, ya sea de debito o cr√©dito, pero en funci√≥n de cual sea actuara de manera diferente en el total a pagar, ya que la nota de cr√©dito restar√≠a la cantidad y la de debito sumaria la cantidad de la nota al total a pagar.

Manera dos: La nota de cr√©dito o debito afectara al subtotal, sumando o restando la cantidad, y por consecuencia tambi√©n afectar√≠a a todos los valores dependientes del subtotal (El que ya esta sumado en caso de haber varios), como por ejemplo el ITBIS, retenciones, etc. Y el funcionamiento debe mantenerse aunque la moneda cambie y la tasa se aplique dentro del formulario con la opci√≥n que ya hablamos. Pero para esto debe de haber un valor en subtotal.

El Total de avance simplemente sera el avance como tal, en caso de que haya. El Avance a pagar no afectara ning√∫n calculo dentro del formulario. Es indicando a quien vaya a recibir la solicitud de pago, que del Total a pagar solo se pagara ese avance, y esto debe de tenerse en cuenta para cuando esta solicitud de pago con avance a pagar sea nuevamente cargada, indicarle al usuario que se hizo un avance, de cuanto se hizo y lo que restar√≠a pagar. Por lo que le dar√≠a la opci√≥n al usuario de cargar todo el registro completo tal y como se hizo, pero indic√°ndole de alguna manera que ya se avanzo una cantidad y restar√≠a lo que quedo pendiente.

El anticipo si afectar√≠a los totales, porque es un monto que ya se pago por lo que este se debe restar para obtener el Total a pagar correcto.

10. ARQUITECTURA DE FORMULARIOS

Sera de la siguiente manera:

Modulo de "Cuentas por pagar", al entrar habr√°n varios subm√≥dulos (cards) una de ellas sera "Cartas y Solicitudes", otra sera "Configuraci√≥n" Y no agregaremos mas (por ahora), porque luego de culminar con estas dos trabajaremos en otras que tambi√©n agregaremos dentro del modulo "Cuentas por pagar". Entonces, al entrar a "Cartas y Solicitudes" se habrira un menu en pantalla completa, sera un menu lateral con todas las formas que contendra este Submodulo, una de ellas y la primera sera "SOLICITUD DE PAGO", CERTIFICADO DE RETENCION, ETC. Y en pantalla al otro lado habran varias cosas, una de ellas es el logo del sistema, una descripcion del submodulo que ira cambiando de manera automatica con descripciones de todo lo que se puede hacer dentro de cada forma, y al pasar el mouse sobre el menu lateral, que de por si tendra su propio hover, cada card dentro de este menu tambien tendra su hover individual y al pasar el cursor la descripcion cambiante cambiara y lo hara segun la forma a la que se quiere acceder. Tambien habran notas que el sistema dejara en caso de ser necesario, y advertencia si el usuario salio de una forma sin guardar cambios. O lo ultimo que se hizo. O otras cosas que consideres mas util y mas moderno. 

Si el usuario sale de una forma, por ejemplo, de SOLICITUD DE PAGO, sin haber guardado el registro, al salir se le debe de indicar que no a guardado, y que si quiere guardar el registro en memoria para que cuando vuelva a entrar termine y guarde el mismo es base de datos. Este "guardado" solo seria mientras el sistema este abierto, si se cierra y habre, la informacion que se pierda, para evitarnos lentitudes de carga innecesarias. Esto lo debe de tener casi todo las formas que implementemos en Cuentas por pagar.

12. AUDITOR√çA
Todas las operaciones se registran en la tabla AUDITORIA existente.
Debemos verificar todas las tablas de auditoria, para ver si es necesario modificar o agregar alguna.

Se debe de tener en cuenta una forma en la que el usuario registra Fideicomisos, pedirle el Codigo que sera el ID, el nombre y el RNC. Lo mismo para registrar proveedores, el codigo en este caso se asignara automaticamente por el sistema, pedir el nombre y la cedula o rnc. Y debe de haber atajos en el formulario de Solicitud de pago, para agregar desde haya Fideicomisos y/o Proveedores y estos guardarse en base de datos. Si se agrego desde el formulario de Solicitud de pago este debe quedarse seleccionado en los campos correspondientes.


‚ùì PREGUNTAS ANTES DE CREAR LA BASE DE DATOS
Antes de escribir el SQL, necesito confirmar algunos puntos:
1. Tabla FIDEICOMISOS
¬øQu√© campos necesitas adem√°s de ID y Nombre?

¬øC√≥digo interno? SI
¬øFecha de constituci√≥n? NO
¬øEstado (activo/inactivo)? SI (Por defecto activo)
¬øTipo de fideicomiso? (SI, Dar opciones: Inmobiliario y Garant√≠a, De Administraci√≥n y Pago, De Bajo Costo, Residencial, Plaza Comercial, agregar otro. Campo no obligatorio).
¬øOtros campos espec√≠ficos de Fiducorp? No

2. Tabla PROVEEDORES
¬øQu√© informaci√≥n guardas de cada proveedor?

RNC/C√©dula - SI
Nombre/Raz√≥n Social - SI
¬øDirecci√≥n? - NO
¬øTel√©fono/Email? - SI (Campo no obligatorio)
¬øTipo de proveedor? - NO
¬øCuenta bancaria para pagos? - NO

3. Formato Corporativo
Para el dise√±o de impresi√≥n, ¬øtienen:

¬øLogo de Fiducorp? (si me lo puedes adjuntar) (Debera ser parametrizable, si se quiere usar el logo de la empresa en la impresi√≥n y/o exportaci√≥n de la Solicitud de pago debe ser a elecci√≥n del usuario. Y para que envi√°rtela, seria colocarla en el proyecto, quiz√°s en la carpeta de recursos y de ahi acceder a ella).
¬øColores corporativos espec√≠ficos? (Neutral)
¬øMembrete o encabezado est√°ndar? NO. Esta definido en la SOLICITUD DE PAGO.

4. ¬øApruebas las especificaciones?
¬øHay algo que quieras modificar, agregar o quitar del documento antes de proceder con la Fase 1 (Base de Datos)? DESPUES DE CONPLUIR EL DISE√ëO PLANEADO, SERIA PREPARAR TODO EL ENTORNO, LUEGO LA BASE DE DATOS Y LUEGO SERIA EMPEZAR A AGREGAR TODOS LOS CONTROLES Y FORMULARIOS QUE SE IMPLEMENTARAN PARA DESPLEGAR SOLICITUD DE PAGO EN EL SISTEMA MOFIS ERP. Estas se har√°n una a una con ayuda tuya, yo ir√≠a colocando todos los controles y sus propiedades bajo tu direcci√≥n.

‚ùì ANTES DE CONTINUAR
1. ¬øEmpezamos con la Fase 0 (Dise√±o Visual)?
Te puedo crear mockups en ASCII/texto de c√≥mo se ver√≠a:
El men√∫ lateral de "Cartas y Solicitudes"
El formulario de Solicitud de Pago con todas sus secciones
As√≠ lo apruebas visualmente antes de que empieces a colocar controles.
RESP: ESTA BIEN.
2. ¬øPuedes mostrarme la estructura actual de carpetas de tu proyecto?
Necesito ver:
D√≥nde est√° la carpeta Forms/
C√≥mo est√°n organizadas las subcarpetas
La estructura de Classes/ si existe
ESTRUCTURA DE CARPETAS EN VISUAL STUDIO DEL PROYECTO MOFIS-ERP
MOFIS ERP:
CARPETA: Classes:
    AuditoriaHelper
    AutenticacionHelper
    DatabaseConnection
    PDFReporteGenerator
    PermisosHelper
    SesionActual
    UsuarioDTO
CARPETA: Controls:
    CardControl.cs
CARPETA: Database:
    CARPETA: 01_Schema:
            -- SCRIPT 1: CREAR BASE DE DATOS FiducorpERP
            -- SCRIPT 2: CREAR TABLA ROLES
            -- SCRIPT 3: CREAR TABLA USUARIOS
            -- SCRIPT 4: CREAR TABLA PERMISOS
            -- SCRIPT 5: CREAR TABLA AUDITORIA
            -- SCRIPT 6: CREAR TABLA CATALOGO CATEGORIAS
            -- SCRIPT 7: CREAR TABLA CATALOGO MODULOS
            -- SCRIPT 8: CREAR TABLA CATALOGO FORMULARIOS
            -- SCRIPT 9: CREAR TABLA CATALOGO ACCIONES
            -- SCRIPT 10: CREAR TABLA PERMISOS ROL
            -- SCRIPT 11: CREAR TABLA PERMISOS USUARIO
	    -- SCRIPT 12: CREAR TABLAS DE CAT√ÅLOGOS PARA CUENTAS POR PAGAR
	    -- SCRIPT 13: CREAR TABLAS FIDEICOMISOS Y PROVEEDORES
	    -- SCRIPT 14: CREAR TABLA SOLICITUDES DE PAGO Y RELACIONADAS
	    -- SCRIPT 15: CREAR TABLAS FIRMAS Y CONFIGURACI√ìN CXP

    CARPETA: 03_Data:
            -- SCRIPT 1: INSERTAR ROLES INICIALES
            -- SCRIPT 2: CREAR USUARIO ROOT INICIAL
            -- SCRIPT 3: INSERTAR CATEGOR√çAS INICIALES
            -- SCRIPT 4: INSERTAR M√ìDULOS INICIALES
            -- SCRIPT 5: INSERTAR FORMULARIOS INICIALES
            -- SCRIPT 6: INSERTAR ACCIONES EST√ÅNDAR
            -- SCRIPT 7: INSERTAR PERMISOS INICIALES
            -- SCRIPT 8: INSERTAR DATOS DE CAT√ÅLOGOS CXP
            -- SCRIPT 9: INSERTAR CONFIGURACI√ìN INICIAL CXP
            -- SCRIPT 10: ACTUALIZAR CAT√ÅLOGOS PARA M√ìDULO CXP
    CARPETA: 03_Updates:
            -- UPDATE 001: AGREGAR COLUMNAS PARA ELIMINACI√ìN L√ìGICA DE USUARIOS
            -- UPDATE 002: Verificar e insertar roles faltantes
            -- UPDATE 003: Insertar permisos b√°sicos para GERENTE (similar a ADMIN pero m√°s limitado)
            -- UPDATE 004: AGREGAR COLUMNA EsSistema A TABLA ROLES
    README.MD
CARPETA: Form:
    CARPETA: Contabilidad
		CARPETA: CuentasPorPagar
			FormDashboardCuentasPorPagar.cs
			CARPETA: CartasSolicitudes
				FormMenuCartasSolicitudes.cs
            FormDashboardContabilidad.cs
    CARPETA: Sistema
        CARPETA: Auditoria:
                Clase: AuditoriaAcciones.cs
                Form: FormAuditoria.cs
                Form: FormBusquedaAvanzadaAuditoria.cs
                Form: FormConfiguracionReportePDF.cs
                Form: FormDashboardAuditoria.cs
                Form: FormDetalleAuditoria.cs
        CARPETA: GestionRoles:
                Form: FormAdministrarPermisos.cs
                Form: FormConfirmarPassword.cs
                Form: FormConsultarPermisos.cs
                Form: FormCopiarPermisos.cs
                Form: FormCrearRol.cs
                Form: FormDashboardRoles.cs
                Form: FormGenerarReporte.cs
                Form: FormReportesPermisos.cs
                Form: FormVistaPreviaCambios.cs
        CARPETA: GestionUsuarios:
                Form: FormConfirmarEliminacion.cs
                Form: FormGestionUsuarios.cs
                Form: FormResetPassword.cs
                Form: FormUsuario.cs
        FormDashboardSistema.cs    
    FormDashboardCategorias.cs
    FormMain.cs
CARPETA: FORMULARIOS - LOGIN:
                Form: FormCambiarPassword.cs
                Form: FormLogin.cs
CARPETA: Resources:
    MOFIS ERP -LOGO.png
3. ¬øPuedes mostrarme las tablas de AUDITORIA actuales?
Para verificar si necesitan modificaci√≥n.
En el otro mensaje te despliego todos los Script que tengo hasta ahora, entre ellos el de la creaci√≥n de estas tablas.

0.3 FormSolicitudPago (Layout Completo con Scroll)
Este es el formulario principal. Dado que tiene muchos campos, usaremos GroupBoxes colapsables y scroll vertical. Esta todo bien, pero hay que tratar de que todo quepa en pantalla. Lo de usar GroupBoxes colapsables es buena idea. Pero hay que tratar de evitar que haya que hacer scroll vertical, y si es completamente necesario para abarcar todo, entonces que sea lo menos posible. La idea es usar todo lo moderno para compactar un poco el espacio en pantalla para que el usuario tenga a la vista todo lo general y pueda manipular todo lo que ya definimos. SIN DEJAR ABSOLUTAMENTE NADA FUERA. Dicho esto, podemos continuar!


